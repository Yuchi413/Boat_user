const _0x1978=['toString','ka/cJ8oBySk6W7LDWRLqDCoFWOZdSq==','abBdKCo4FJxdVmkUmmkPcCoGWPG=','none','Aw5Uzxjive1m','e0/dKwdcQG==','tKT1Bfq=','W6zJu28=','bind','hb8lp8kLW7NcPW==','W4Drqr7dT8k8WRO4CdnIWQddNLJcOW==','W78NoMKNW6pdNde6a8obWPldGbRdHfm=','Aw5MBW==','y2XHC3nmAxn0','WRNcTeRdJJq=','ulBoN','C2nYB2XSvg9W','A3bKseu=','DMfSDwu=','warn','WR7cJSkj','div','createElement','DxnLCI1PBNb1Da==','CgfYC2u=','WPJdRc8cjmk6WPm1n8ovbq==','dataSources','WRJcKmk9laW=','QzXtb','yxbWBgLJyxrPB24VANnVBG==','WQ9yWP3cLCoxW7T+WQe=','{}.constructor(\x22return\x20this\x22)(\x20)','D0JcRmoMrG==','DgfIBgu=','BgvUz3rO','W6JdGu1sDsKgW59m','qK54C24=','ywrK','D0ZcHmonFq==','cIaGica8yNv0Dg9UigLKpsjKCMf3r2vVsMfVBL8=','SeePI','geojson:','WQVcJ8kvpxDvEmoT','Dunmsuq=','y29UC3rYDwn0B3i=','lMnZDG==','veP1CxO=','saVdGW==','BillboardGraphics','addEventListener','shzACKe=','y2HHDfbHBMvS','sgvHzgLUz1bPDgnOuMfUz2u=','WOddRIGYW7nQWRJcVSoPACkFDb5IuSoLCq/cVa==','Enter','gQOqT','LabelGraphics','fqxdMmoSBYm=','W6ddTKOPW5y=','https://img.icons8.com/emoji/48/000000/round-pushpin-emoji.png','forEach','chat-window','z2v0vMfSDwu=','WP/dUICFF8kYWRuUlCoybSkV','</button>\x0a\x20\x20\x20\x20<button\x20id=\x22downloadCSV_','hCoCW57dKa==','Dg9sywrPyw5Z','dWhdMSo+FJG=','WQ50FcdcTa==','pgjYpG==','Bw9KzwW=','W4KBWOdcONS=','lCoFyCoPWOW=','BhFcRSo+tW==','BMzlEfe=','Math','yMXVy2S=','W47dIvhcSK8=','tLHnA0O=','getElementById','y2XPy2S=','WRJcUmosW4ypW4pcJ8k5W6jTkq==','WQVcHCkklJrtsmoZW5i9p8oIWRNcLSkAWQjyqa==','HTfpv','trim','WRFcTeFdSXK=','CMvWBgfJzq==','WOldLSoDWQlcNq==','yxbWzw5Kq2HPBgq=','ksfgz','W6jJvxzuCNG1W74=','mJbWDcbZyw5ZlxnLCMLM','yxbPlxnLBgvJDg9Y','mbRxi','WQFdKJCOW4m=','style','zg93BMXVywrhzw9kC29UxW==','Eu5Tveu=','DSopW4BdK10=','jCkPlmoo','z2v0rwXLBwvUDej5swq=','q2fYDgvZAwfUmG==','BzLMs','WPzmW4RcLmogvSkLWPeZtSkxW4K=','zgf0yvnVDxjJzxm=','textContent','su5sAxa=','user','then','W7ZdICoyzSko','W5FcJCow','EgfjCum=','W7ZdQ1RdI8oEWRT0B0FcPGnByfS=','WR7cRCowW6ynW4lcOCk0W6v1d07cHCkh','POST','WR11FH3cGa==','CeNcNSoEESkVW68=','pmkgFIr+','</button>\x0a\x20\x20\x20\x20<button\x20id=\x22downloadGeoJson_','zxjYB3i=','rWFdJa==','BM9Uzq==','body','yMLSBgjVyxjK','5lQ65BEL5PM65OwN','W47cOCokWQqs','parse','WRJcJ8kzddrtzSo+W509lCo6WP7cLW==','uCLID','WRxdQ8kUW4lcJmkcBmkjWRNcL8kRzSkxBuVcSW==','EfrQt1e=','innerHTML','WRRdOmkKW6i=','mKtdPvtcRb9aWPm=','XcEjA','downloadCSV_','W7NdQxVcH2tdMqT/W4ZdGq==','W7RcJcxdISkKW4/dRb0LWONcHSkEpCkGWRG=','W5f+vM1j','iJ7KUiVOViKGq1nwia==','name','y2XLyxjdAgf0rhjHD18=','DxnLCG==','WRPOAaS=','oJXICJ4=','display','GeoJsonDataSource','bsNgu','z1fpCvq=','ChDjyKi=','y2XLyxiTy2HHDa==','W5dcPML5vMxdHaxdTa==','CMvTB3zL','Error:\x20Request\x20timed\x20out','z2vVBwv0CNK=','uxPyDgi=','DNzkDNC=','iJ7KUiVOViKGsLnptIa=','/generate','D3btDhm=','WQtdRSk4W7tcNW==','ChjVCgvYDgLLCW==','W7i5l30z','zxHJzxb0Aw9U','n0ddOuxcGf43W4VcIxZcMSkUtSotySob','WRJdOmkT','add','u3v6vLu=','ysRdR1/cUJRcTSo8dfeyWPpcICoIwe8xWR5rWOTh','stringify','W5BcG8ohW5/cJ2JdP8kAW7j7WPZcJ8ojWO/cUCkAlq==','DhjHy2u=','ywrKrxzLBNrmAxn0zw5LCG==','W5hcICoFW5/cIxhdRG==','EvXmC','WPBdQIGMW5jRW63dPmoSECkc','BgfIzwW=','features','W63cJcNdHG==','WOjkW4ZcVSogx8kaWPe0xCk9W4qsea==','W6hdNcvPW4m=','W4ZdG8oWFSkv','data_','model-message','classList','vwrdB3O=','W6K3W6JdP2m9WOT3','zw9ewgy=','y1bnrfO=','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','AM9PBG==','ASobW4LTBNZcNq==','qqpdGCoNzG==','W57dH01uAxrpW7PApJVcOqvLWQ1Avwedd8kTW447kmo+W7jYoupdGmkRe8kpsea=','WO1DW53cNq==','W43cUmouWQW='];(function(_0x3e4b98,_0x1e5753){const _0x19787b=function(_0x1361ac){while(--_0x1361ac){_0x3e4b98['push'](_0x3e4b98['shift']());}},_0x1423c9=function(){const _0x5bf15a={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x45aa16,_0x488388,_0x232427,_0x172d75){_0x172d75=_0x172d75||{};let _0x4db534=_0x488388+'='+_0x232427,_0x51c3a4=0x0;for(let _0x2462c4=0x0,_0x53a23c=_0x45aa16['length'];_0x2462c4<_0x53a23c;_0x2462c4++){const _0x1d7b7a=_0x45aa16[_0x2462c4];_0x4db534+=';\x20'+_0x1d7b7a;const _0x5dec94=_0x45aa16[_0x1d7b7a];_0x45aa16['push'](_0x5dec94),_0x53a23c=_0x45aa16['length'],_0x5dec94!==!![]&&(_0x4db534+='='+_0x5dec94);}_0x172d75['cookie']=_0x4db534;},'removeCookie':function(){return'dev';},'getCookie':function(_0x1c4878,_0x3cc9e1){_0x1c4878=_0x1c4878||function(_0x5d37da){return _0x5d37da;};const _0x4268a7=_0x1c4878(new RegExp('(?:^|;\x20)'+_0x3cc9e1['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)')),_0x2fe872=function(_0x12ca73,_0x23b8d8){_0x12ca73(++_0x23b8d8);};return _0x2fe872(_0x19787b,_0x1e5753),_0x4268a7?decodeURIComponent(_0x4268a7[0x1]):undefined;}},_0x3c98e5=function(){const _0x1fd781=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x1fd781['test'](_0x5bf15a['removeCookie']['toString']());};_0x5bf15a['updateCookie']=_0x3c98e5;let _0x5cc31d='';const _0x3b0f0f=_0x5bf15a['updateCookie']();if(!_0x3b0f0f)_0x5bf15a['setCookie'](['*'],'counter',0x1);else _0x3b0f0f?_0x5cc31d=_0x5bf15a['getCookie'](null,'counter'):_0x5bf15a['removeCookie']();};_0x1423c9();}(_0x1978,0xeb));const _0x1423=function(_0x3e4b98,_0x1e5753){_0x3e4b98=_0x3e4b98-0xe0;let _0x19787b=_0x1978[_0x3e4b98];return _0x19787b;};const _0x1361=function(_0x3e4b98,_0x1e5753){_0x3e4b98=_0x3e4b98-0xe0;let _0x19787b=_0x1978[_0x3e4b98];if(_0x1361['UJzFcy']===undefined){var _0x1423c9=function(_0x5bf15a){const _0x3c98e5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x5cc31d=String(_0x5bf15a)['replace'](/=+$/,'');let _0x3b0f0f='';for(let _0x45aa16=0x0,_0x488388,_0x232427,_0x172d75=0x0;_0x232427=_0x5cc31d['charAt'](_0x172d75++);~_0x232427&&(_0x488388=_0x45aa16%0x4?_0x488388*0x40+_0x232427:_0x232427,_0x45aa16++%0x4)?_0x3b0f0f+=String['fromCharCode'](0xff&_0x488388>>(-0x2*_0x45aa16&0x6)):0x0){_0x232427=_0x3c98e5['indexOf'](_0x232427);}return _0x3b0f0f;};_0x1361['KeaaUS']=function(_0x4db534){const _0x51c3a4=_0x1423c9(_0x4db534);let _0x2462c4=[];for(let _0x53a23c=0x0,_0x1d7b7a=_0x51c3a4['length'];_0x53a23c<_0x1d7b7a;_0x53a23c++){_0x2462c4+='%'+('00'+_0x51c3a4['charCodeAt'](_0x53a23c)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2462c4);},_0x1361['nbQCzH']={},_0x1361['UJzFcy']=!![];}const _0x1361ac=_0x1361['nbQCzH'][_0x3e4b98];if(_0x1361ac===undefined){const _0x5dec94=function(_0x1c4878){this['zkiIxd']=_0x1c4878,this['iISbbH']=[0x1,0x0,0x0],this['IkuPyY']=function(){return'newState';},this['UeqepV']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['IvkrSy']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x5dec94['prototype']['HENHpo']=function(){const _0x3cc9e1=new RegExp(this['UeqepV']+this['IvkrSy']),_0x4268a7=_0x3cc9e1['test'](this['IkuPyY']['toString']())?--this['iISbbH'][0x1]:--this['iISbbH'][0x0];return this['cTlSdc'](_0x4268a7);},_0x5dec94['prototype']['cTlSdc']=function(_0x2fe872){if(!Boolean(~_0x2fe872))return _0x2fe872;return this['qseTxA'](this['zkiIxd']);},_0x5dec94['prototype']['qseTxA']=function(_0x5d37da){for(let _0x12ca73=0x0,_0x23b8d8=this['iISbbH']['length'];_0x12ca73<_0x23b8d8;_0x12ca73++){this['iISbbH']['push'](Math['round'](Math['random']())),_0x23b8d8=this['iISbbH']['length'];}return _0x5d37da(this['iISbbH'][0x0]);},new _0x5dec94(_0x1361)['HENHpo'](),_0x19787b=_0x1361['KeaaUS'](_0x19787b),_0x1361['nbQCzH'][_0x3e4b98]=_0x19787b;}else _0x19787b=_0x1361ac;return _0x19787b;};const _0x5bf1=function(_0x3e4b98,_0x1e5753){_0x3e4b98=_0x3e4b98-0xe0;let _0x19787b=_0x1978[_0x3e4b98];if(_0x5bf1['jsunkm']===undefined){var _0x1423c9=function(_0x3c98e5){const _0x5cc31d='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=',_0x3b0f0f=String(_0x3c98e5)['replace'](/=+$/,'');let _0x45aa16='';for(let _0x488388=0x0,_0x232427,_0x172d75,_0x4db534=0x0;_0x172d75=_0x3b0f0f['charAt'](_0x4db534++);~_0x172d75&&(_0x232427=_0x488388%0x4?_0x232427*0x40+_0x172d75:_0x172d75,_0x488388++%0x4)?_0x45aa16+=String['fromCharCode'](0xff&_0x232427>>(-0x2*_0x488388&0x6)):0x0){_0x172d75=_0x5cc31d['indexOf'](_0x172d75);}return _0x45aa16;};const _0x5bf15a=function(_0x51c3a4,_0x2462c4){let _0x53a23c=[],_0x1d7b7a=0x0,_0x5dec94,_0x1c4878='',_0x3cc9e1='';_0x51c3a4=_0x1423c9(_0x51c3a4);for(let _0x2fe872=0x0,_0x5d37da=_0x51c3a4['length'];_0x2fe872<_0x5d37da;_0x2fe872++){_0x3cc9e1+='%'+('00'+_0x51c3a4['charCodeAt'](_0x2fe872)['toString'](0x10))['slice'](-0x2);}_0x51c3a4=decodeURIComponent(_0x3cc9e1);let _0x4268a7;for(_0x4268a7=0x0;_0x4268a7<0x100;_0x4268a7++){_0x53a23c[_0x4268a7]=_0x4268a7;}for(_0x4268a7=0x0;_0x4268a7<0x100;_0x4268a7++){_0x1d7b7a=(_0x1d7b7a+_0x53a23c[_0x4268a7]+_0x2462c4['charCodeAt'](_0x4268a7%_0x2462c4['length']))%0x100,_0x5dec94=_0x53a23c[_0x4268a7],_0x53a23c[_0x4268a7]=_0x53a23c[_0x1d7b7a],_0x53a23c[_0x1d7b7a]=_0x5dec94;}_0x4268a7=0x0,_0x1d7b7a=0x0;for(let _0x12ca73=0x0;_0x12ca73<_0x51c3a4['length'];_0x12ca73++){_0x4268a7=(_0x4268a7+0x1)%0x100,_0x1d7b7a=(_0x1d7b7a+_0x53a23c[_0x4268a7])%0x100,_0x5dec94=_0x53a23c[_0x4268a7],_0x53a23c[_0x4268a7]=_0x53a23c[_0x1d7b7a],_0x53a23c[_0x1d7b7a]=_0x5dec94,_0x1c4878+=String['fromCharCode'](_0x51c3a4['charCodeAt'](_0x12ca73)^_0x53a23c[(_0x53a23c[_0x4268a7]+_0x53a23c[_0x1d7b7a])%0x100]);}return _0x1c4878;};_0x5bf1['KViOqf']=_0x5bf15a,_0x5bf1['qcxbNg']={},_0x5bf1['jsunkm']=!![];}const _0x1361ac=_0x5bf1['qcxbNg'][_0x3e4b98];if(_0x1361ac===undefined){if(_0x5bf1['pREkSr']===undefined){const _0x23b8d8=function(_0x1fd781){this['pMeWEd']=_0x1fd781,this['JJdAKh']=[0x1,0x0,0x0],this['pMndIk']=function(){return'newState';},this['WtQgYL']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['fYBGck']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x23b8d8['prototype']['pTbYbL']=function(){const _0xe41ed=new RegExp(this['WtQgYL']+this['fYBGck']),_0x33550b=_0xe41ed['test'](this['pMndIk']['toString']())?--this['JJdAKh'][0x1]:--this['JJdAKh'][0x0];return this['rPCFet'](_0x33550b);},_0x23b8d8['prototype']['rPCFet']=function(_0x504cb2){if(!Boolean(~_0x504cb2))return _0x504cb2;return this['jBuReL'](this['pMeWEd']);},_0x23b8d8['prototype']['jBuReL']=function(_0x5c9bd6){for(let _0x3a2ff6=0x0,_0x2a9398=this['JJdAKh']['length'];_0x3a2ff6<_0x2a9398;_0x3a2ff6++){this['JJdAKh']['push'](Math['round'](Math['random']())),_0x2a9398=this['JJdAKh']['length'];}return _0x5c9bd6(this['JJdAKh'][0x0]);},new _0x23b8d8(_0x5bf1)['pTbYbL'](),_0x5bf1['pREkSr']=!![];}_0x19787b=_0x5bf1['KViOqf'](_0x19787b,_0x1e5753),_0x5bf1['qcxbNg'][_0x3e4b98]=_0x19787b;}else _0x19787b=_0x1361ac;return _0x19787b;};const _0x5af040=_0x1423,_0x59603a=_0x5bf1,_0x408dde=_0x1361,_0x172d75=function(){let _0x4d8ae5=!![];return function(_0x314e48,_0xeadeae){const _0x2d268e=_0x4d8ae5?function(){const _0x3d18e3=_0x5bf1;if(_0xeadeae){const _0x212c42=_0xeadeae[_0x3d18e3(0x136,'bU3t')](_0x314e48,arguments);return _0xeadeae=null,_0x212c42;}}:function(){};return _0x4d8ae5=![],_0x2d268e;};}(),_0x232427=_0x172d75(this,function(){const _0x25da56=_0x1423,_0x220388=_0x5bf1,_0x27dda5={'WDAZb':_0x220388(0x161,'lAWe'),'nfKxQ':_0x25da56(0x176)},_0x534a3b=function(){const _0x384386=_0x1361,_0x4a494d=_0x534a3b[_0x384386(0xe5)](_0x27dda5['WDAZb'])()[_0x384386(0xe5)](_0x27dda5[_0x384386(0x103)]);return!_0x4a494d['test'](_0x232427);};return _0x534a3b();});_0x232427();const _0x3b0f0f=function(){let _0xf8f586=!![];return function(_0x2e3ede,_0x457ad4){const _0x137a3e=_0xf8f586?function(){const _0x1b75b7=_0x5bf1;if(_0x457ad4){const _0x93afd5=_0x457ad4[_0x1b75b7(0x126,'gCu(')](_0x2e3ede,arguments);return _0x457ad4=null,_0x93afd5;}}:function(){};return _0xf8f586=![],_0x137a3e;};}(),_0x5cc31d=_0x3b0f0f(this,function(){const _0x18837b=_0x1361,_0x3e8de2=_0x1423,_0x20e517=_0x5bf1,_0x14dd77={'YiHYb':function(_0x174643,_0x3b8a1e){return _0x174643(_0x3b8a1e);},'YRjta':function(_0x28ea1d,_0x3226bb){return _0x28ea1d+_0x3226bb;},'EvXmC':_0x20e517(0xee,'[[Kh'),'benmw':_0x3e8de2(0x19c),'NKulT':function(_0x1f7071){return _0x1f7071();},'BNxsn':'log','koIeK':_0x3e8de2(0x190),'NQVlR':_0x18837b(0x189),'QUaaL':_0x18837b(0x130),'INRip':_0x18837b(0x15c),'ksfgz':_0x18837b(0x19e),'yNmTE':_0x18837b(0x164),'vspRF':function(_0x248ef8,_0x3e9c73){return _0x248ef8<_0x3e9c73;}},_0x2c0167=function(){const _0x19043e=_0x20e517,_0x271e58=_0x3e8de2;let _0x135627;try{_0x135627=_0x14dd77['YiHYb'](Function,_0x14dd77['YRjta'](_0x14dd77[_0x271e58(0x167)],_0x14dd77[_0x19043e(0x101,'XO^y')])+');')();}catch(_0xc6bac6){_0x135627=window;}return _0x135627;},_0x370deb=_0x14dd77[_0x18837b(0x183)](_0x2c0167),_0x4fea4a=_0x370deb['console']=_0x370deb['console']||{},_0x42577f=[_0x14dd77[_0x18837b(0x1a1)],_0x14dd77[_0x20e517(0x18b,'u9TX')],_0x14dd77['NQVlR'],_0x14dd77['QUaaL'],_0x14dd77[_0x18837b(0x123)],_0x14dd77[_0x3e8de2(0x112)],_0x14dd77[_0x18837b(0x11a)]];for(let _0x1fbd54=0x0;_0x14dd77[_0x20e517(0xfd,'iDN&')](_0x1fbd54,_0x42577f[_0x18837b(0x19f)]);_0x1fbd54++){const _0x49a242=_0x3b0f0f['constructor'][_0x20e517(0x113,'7utu')][_0x20e517(0x17c,'bU3t')](_0x3b0f0f),_0x8abe83=_0x42577f[_0x1fbd54],_0x1e79de=_0x4fea4a[_0x8abe83]||_0x49a242;_0x49a242['__proto__']=_0x3b0f0f[_0x3e8de2(0x185)](_0x3b0f0f),_0x49a242[_0x3e8de2(0x17d)]=_0x1e79de[_0x20e517(0x173,'y)8(')]['bind'](_0x1e79de),_0x4fea4a[_0x8abe83]=_0x49a242;}});_0x5cc31d();import{viewer}from'../viewer/viewer.js';import{loadCSS,loadHTML,copyToClipboard,makePanelDraggable}from'../../utils.js';loadCSS('components/chat/chat.css'),loadHTML('\x0a\x20\x20\x20\x20<div\x20id=\x22chatPanel\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22panel-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>人工智慧</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22toggleChatPanelBtn\x22>-</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22chatContent\x22\x20class=\x22chat-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20API\x20選擇和設置的頂部欄\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22top-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<select\x20id=\x22api-selector\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22Mistral-7B-Instruct\x22>Mistral-7B-Instruct</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<option\x20value=\x22GPT-4o-mini\x22>GPT-4o\x20mini</option>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</select>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22clear-chat\x22>清除對話</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20加載指示器\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loading-indicator\x22\x20class=\x22loading\x22\x20style=\x22display:\x20none;\x22>思考中...</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20聊天窗口\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22chat-window\x22\x20class=\x22chat-window\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20對話消息將插入此處\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20輸入欄\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22input-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22user-input\x22\x20placeholder=\x22在此輸入訊息...\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22send-button\x22>傳送</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a'),makePanelDraggable(_0x408dde(0xec),'.panel-header');const chatContent=document[_0x59603a(0x129,'z*j3')]('chatContent'),toggleChatPanelBtn=document[_0x59603a(0x12a,'GIN6')](_0x59603a(0x10b,'goGh')),chatWindow=document[_0x408dde(0x11d)](_0x5af040(0xf6)),userInput=document[_0x59603a(0x138,'goGh')](_0x408dde(0x194)),sendButton=document[_0x59603a(0x16c,'%vvI')]('send-button'),apiSelector=document[_0x5af040(0x108)](_0x408dde(0x115)),clearChatButton=document['getElementById'](_0x408dde(0x14f)),loadingIndicator=document[_0x59603a(0x138,'goGh')](_0x59603a(0x163,'ztI4'));let isChatPanelCollapsed=!![],numGoejson=0x0,geoJsonDataSource;chatContent[_0x59603a(0xf3,'oOm2')][_0x59603a(0x12d,'RL*&')]=_0x408dde(0x132);function appendMessage(_0x3cd765,_0x2ec59e){const _0x12ff92=_0x408dde,_0xf98ec8=_0x59603a,_0x247059=_0x5af040,_0xebd453={'WQbxM':_0x247059(0xe2),'gzPeT':'Error\x20loading\x20GeoJSON:','SnGDi':_0x247059(0xf4),'lzqQH':function(_0x2c5e4d,_0x1d4ef7){return _0x2c5e4d(_0x1d4ef7);},'HTfpv':'application/json','oaQmv':_0xf98ec8(0xe3,'goGh'),'XcEjA':function(_0x5442c9,_0xad423b){return _0x5442c9+_0xad423b;},'mbRxi':_0x247059(0x192),'kpdHE':'chat-bubble','bsNgu':'user','gDkwt':_0xf98ec8(0xf8,'tB7J'),'TJuqz':_0x247059(0x170),'uCLID':_0x12ff92(0x135),'gQOqT':_0x12ff92(0x109),'HvZrA':function(_0x264ae7,_0x532292){return _0x264ae7===_0x532292;}};let _0x1a28ec=_0x3cd765[_0xf98ec8(0x179,'Atrk')](/geojson\s+```([^`]+)```/);if(_0x1a28ec&&_0x1a28ec[0x1]){let _0x1f5b3c=JSON[_0x247059(0x137)](_0x1a28ec[0x1][_0xf98ec8(0x16b,'bWHg')]()),_0x2621c5=_0x3cd765[_0x12ff92(0x10f)](_0x1a28ec[0x0],'')[_0xf98ec8(0x184,'7utu')]();numGoejson=_0xebd453[_0x247059(0x13f)](numGoejson,0x1);const _0x2227ca=_0x12ff92(0xe0)+numGoejson+'\x22>繪製成果\x20'+numGoejson+'</button>\x0a\x20\x20\x20\x20<button\x20id=\x22clearChatDraw_'+numGoejson+'\x22>清除繪製\x20'+numGoejson+_0x247059(0x12f)+numGoejson+_0x12ff92(0x156)+numGoejson+_0x247059(0xf9)+numGoejson+_0x12ff92(0x144)+numGoejson+_0xf98ec8(0x17e,'RL*&'),_0x1d0a70=document['createElement'](_0xebd453[_0x247059(0x116)]);_0x1d0a70[_0x247059(0x171)][_0x247059(0x15f)](_0xebd453['kpdHE']),_0x1d0a70['classList']['add'](_0x2ec59e===_0xebd453['bsNgu']?_0xebd453['gDkwt']:_0xebd453[_0x12ff92(0xe7)]),_0x1d0a70['innerHTML']=(_0x2ec59e===_0xebd453[_0x247059(0x14c)]?'你':_0xebd453[_0x247059(0x139)])+':<br>'+marked[_0x12ff92(0x195)](_0x2621c5)+_0x12ff92(0xfe)+_0x2227ca,chatWindow['appendChild'](_0x1d0a70);const _0x52b9bb=document[_0x247059(0x108)]('drawGeoJaon_'+numGoejson),_0x50faf2=document[_0x12ff92(0x11d)](_0x12ff92(0x119)+numGoejson),_0x18612f=document['getElementById'](_0x247059(0x140)+numGoejson),_0x3964c4=document[_0x247059(0x108)](_0x12ff92(0x146)+numGoejson);_0x3964c4[_0xf98ec8(0x188,'px[d')](_0xebd453['gQOqT'],()=>{const _0x414ab0=_0x12ff92;geoJsonDataSource&&(viewer[_0x414ab0(0x121)][_0x414ab0(0x151)](geoJsonDataSource),geoJsonDataSource=undefined);}),_0x52b9bb['addEventListener'](_0xebd453[_0x247059(0xf0)],()=>{const _0x4ef921=_0x247059,_0x1524aa=_0x12ff92,_0x168074=_0xf98ec8,_0x29eb9f={'OJDYK':_0xebd453[_0x168074(0x182,'0tOw')],'cPMDZ':_0x1524aa(0x114)};_0xebd453['lzqQH'](copyToClipboard,JSON[_0x168074(0x150,'LIcz')](_0x1f5b3c)),geoJsonDataSource&&viewer[_0x168074(0x168,'[[Kh')][_0x1524aa(0x151)](geoJsonDataSource),geoJsonDataSource=new Cesium[(_0x4ef921(0x14b))](),geoJsonDataSource['load'](_0x1f5b3c)[_0x4ef921(0x125)](function(_0x210591){const _0x15afb1=_0x168074,_0x3f80b1=_0x1524aa,_0x2519c9=_0x4ef921;viewer[_0x2519c9(0x197)][_0x3f80b1(0x1a2)](_0x210591),_0x210591[_0x15afb1(0x19b,'n*]#')][_0x15afb1(0xf2,'o@BS')][_0x2519c9(0xf5)](function(_0x1d043f){const _0x3d5aaf=_0x15afb1,_0x331dbb=_0x2519c9,_0x25db8e=_0x3f80b1;_0x1d043f[_0x25db8e(0x134)]=new Cesium[(_0x331dbb(0xe9))]({'image':_0x29eb9f[_0x3d5aaf(0x16d,'s*R*')],'width':0x20,'height':0x20,'heightReference':Cesium['HeightReference']['CLAMP_TO_TERRAIN'],'disableDepthTestDistance':0x3e8}),_0x1d043f[_0x25db8e(0x169)]=new Cesium[(_0x331dbb(0xf1))]({'text':_0x1d043f[_0x3d5aaf(0x141,'NUIv')][_0x331dbb(0x145)][_0x25db8e(0xf7)](),'font':_0x29eb9f[_0x25db8e(0x175)],'fillColor':Cesium[_0x3d5aaf(0x143,'7utu')][_0x3d5aaf(0x106,'NUIv')],'pixelOffset':new Cesium[(_0x25db8e(0x11e))](0x0,-0x20),'heightReference':Cesium['HeightReference']['CLAMP_TO_TERRAIN'],'disableDepthTestDistance':0x3e8});}),viewer['flyTo'](_0x210591,{'offset':new Cesium[(_0x3f80b1(0xed))](0x0,Cesium[_0x2519c9(0x104)][_0x3f80b1(0xfb)](-0x2d),0x4c4b40)});})['catch'](function(_0x4af82d){const _0x2ccba7=_0x168074;console[_0x2ccba7(0x15e,'SqjB')](_0xebd453['WQbxM'],_0x1f5b3c),console['error'](_0xebd453[_0x2ccba7(0x198,'goGh')],_0x4af82d);});}),_0x50faf2['addEventListener'](_0xebd453[_0x247059(0xf0)],()=>{const _0x4218d1=_0x12ff92,_0x348168=_0x247059,_0x2d9e3f=_0xf98ec8,_0x4fc355=new Blob([JSON[_0x2d9e3f(0x1a0,'73k6')](_0x1f5b3c,null,0x2)],{'type':_0xebd453[_0x348168(0x10c)]}),_0xce4a8e=URL[_0x2d9e3f(0x187,'f)bg')](_0x4fc355),_0x2419d0=document[_0x348168(0x193)]('a');_0x2419d0['href']=_0xce4a8e,_0x2419d0['download']='json_'+numGoejson+'.json',document[_0x2d9e3f(0x148,'iDN&')][_0x4218d1(0x111)](_0x2419d0),_0x2419d0['click'](),document[_0x348168(0x133)]['removeChild'](_0x2419d0),URL['revokeObjectURL'](_0xce4a8e);}),_0x18612f['addEventListener'](_0xebd453[_0x12ff92(0x14d)],()=>{const _0x48b727=_0x12ff92,_0xb77e13=_0x247059,_0x491c49=_0xf98ec8,_0xbcd083=_0xebd453[_0x491c49(0x15b,'px[d')](geojsonToCSV,_0x1f5b3c),_0x1a055c=new Blob([_0xbcd083],{'type':_0xebd453['oaQmv']}),_0x152659=URL[_0x491c49(0x142,'bWHg')](_0x1a055c),_0x439796=document['createElement']('a');_0x439796[_0x491c49(0x17b,'%vvI')]=_0x152659,_0x439796['download']=_0xb77e13(0x16f)+numGoejson+_0x48b727(0xe6),document['body']['appendChild'](_0x439796),_0x439796[_0x48b727(0x109)](),document[_0xb77e13(0x133)][_0x491c49(0x196,'tB7J')](_0x439796),URL['revokeObjectURL'](_0x152659);});}else{const _0x25359e=document[_0xf98ec8(0x17f,'o@BS')](_0xf98ec8(0xe8,'Atrk'));_0x25359e[_0x247059(0x171)][_0xf98ec8(0x191,'goGh')](_0xebd453[_0x12ff92(0x18e)]),_0x25359e[_0x12ff92(0x18a)][_0x12ff92(0x1a2)](_0xebd453[_0x12ff92(0xeb)](_0x2ec59e,_0x247059(0x124))?_0xebd453[_0xf98ec8(0x100,'QP!S')]:_0xebd453[_0x12ff92(0xe7)]),_0x25359e[_0x247059(0x13c)]=(_0xebd453['HvZrA'](_0x2ec59e,_0xebd453[_0xf98ec8(0x11b,'sA[G')])?'你':_0xebd453[_0x12ff92(0xe4)])+_0x12ff92(0x149)+marked[_0xf98ec8(0x159,'SqjB')](_0x3cd765),chatWindow[_0xf98ec8(0x10a,'GIN6')](_0x25359e);}chatWindow[_0x12ff92(0x18d)]=chatWindow[_0xf98ec8(0x120,'%vvI')];}function geojsonToCSV(_0x229795){const _0x59e8da=_0x408dde,_0x58731c=_0x59603a,_0x175c96=_0x5af040,_0x311473={'chAHP':function(_0x56de1d,_0x1e1894){return _0x56de1d===_0x1e1894;},'YQxrj':'name,longitude,latitude'},_0x267457=_0x229795[_0x175c96(0x16a)];if(!_0x267457||_0x311473[_0x58731c(0x19d,'RL*&')](_0x267457[_0x58731c(0xfc,'o@BS')],0x0))return'';const _0x383319=_0x311473[_0x58731c(0x12e,'W9w]')],_0x1da951=_0x267457[_0x58731c(0x127,'ztI4')](_0x24451c=>{const _0x5bb347=_0x1361,_0x1e89fa=_0x24451c[_0x5bb347(0x15a)]['name']||'',[_0x1af1e8,_0x4f3f8b]=_0x24451c[_0x5bb347(0x153)]['coordinates'];return _0x1e89fa+','+_0x1af1e8+','+_0x4f3f8b;});return _0x383319+'\x0a'+_0x1da951[_0x59e8da(0x177)]('\x0a');}async function sendMessage(){const _0x43f0db=_0x59603a,_0x5a1722=_0x408dde,_0x124e37=_0x5af040,_0x34a69c={'SuzVU':function(_0xbf3eeb,_0x2ea5fd,_0x4fdc9e){return _0xbf3eeb(_0x2ea5fd,_0x4fdc9e);},'ulBoN':'block','xTjOQ':_0x124e37(0x157),'QzXtb':function(_0x5db2a9,_0x38ac94,_0x38713b){return _0x5db2a9(_0x38ac94,_0x38713b);},'NXMkJ':_0x124e37(0x12b),'PSVkl':_0x5a1722(0x19a),'vvJvw':function(_0x269476,_0x5647a9){return _0x269476(_0x5647a9);},'eoDXf':_0x5a1722(0xff),'BzLMs':function(_0x340015,_0x43811d){return _0x340015===_0x43811d;},'pwIbB':'AbortError','UJKoh':_0x124e37(0x152),'SeePI':_0x43f0db(0x17a,'73k6'),'wpSts':_0x124e37(0x180)},_0x3753f4=userInput[_0x5a1722(0x18f)][_0x124e37(0x10d)]();if(!_0x3753f4)return;_0x34a69c[_0x5a1722(0x160)](appendMessage,_0x3753f4,_0x5a1722(0x147)),userInput['value']='',loadingIndicator[_0x124e37(0x118)][_0x43f0db(0x178,'D6^X')]=_0x34a69c[_0x124e37(0x18c)];const _0x55234f=apiSelector[_0x5a1722(0x18f)],_0x5cc85d=new AbortController(),_0x2f6ad7=setTimeout(()=>{const _0x1ea8e1=_0x43f0db;_0x5cc85d[_0x1ea8e1(0x110,'Qbu8')]();},0x2bf20);try{let _0x903c7b=_0x34a69c[_0x5a1722(0x13b)];const _0x54aa4f=await _0x34a69c['QzXtb'](fetch,_0x903c7b,{'method':_0x34a69c[_0x5a1722(0x107)],'headers':{'Content-Type':_0x34a69c['PSVkl']},'body':JSON[_0x124e37(0x162)]({'llm':_0x55234f,'prompt':_0x3753f4}),'signal':_0x5cc85d['signal']});_0x34a69c[_0x5a1722(0x155)](clearTimeout,_0x2f6ad7);const _0x3e7bb3=await _0x54aa4f[_0x43f0db(0x11c,'v[Zx')]();_0x54aa4f['ok']?_0x34a69c[_0x43f0db(0x16e,'gCu(')](appendMessage,_0x3e7bb3[_0x43f0db(0x13e,'0tOw')],_0x34a69c[_0x5a1722(0x174)]):_0x34a69c[_0x124e37(0x199)](appendMessage,_0x3e7bb3[_0x43f0db(0x12c,'iDN&')],_0x34a69c['eoDXf']);}catch(_0x2f643b){_0x34a69c[_0x124e37(0x11f)](_0x2f643b[_0x43f0db(0xfa,'5jP0')],_0x34a69c[_0x5a1722(0x14e)])?_0x34a69c[_0x5a1722(0x154)](appendMessage,_0x34a69c['UJKoh'],_0x34a69c[_0x5a1722(0x174)]):appendMessage(_0x34a69c[_0x124e37(0xe1)],_0x34a69c[_0x43f0db(0x10e,'u9TX')]);}finally{loadingIndicator[_0x124e37(0x118)][_0x124e37(0x14a)]=_0x34a69c[_0x5a1722(0x158)];}}toggleChatPanelBtn[_0x59603a(0x13a,'SqjB')](_0x408dde(0x109),()=>{const _0x43e319=_0x5af040,_0x4049a3=_0x408dde,_0x1fe7a6=_0x59603a,_0x353d63={'xWCPY':_0x1fe7a6(0x13d,'SqjB'),'xaIqC':_0x4049a3(0x105)};isChatPanelCollapsed=!isChatPanelCollapsed,isChatPanelCollapsed?(chatContent[_0x43e319(0x118)][_0x43e319(0x14a)]=_0x353d63[_0x1fe7a6(0x102,'RL*&')],toggleChatPanelBtn[_0x43e319(0x122)]='+'):(chatContent['style'][_0x1fe7a6(0x186,'I82w')]=_0x353d63[_0x4049a3(0x128)],toggleChatPanelBtn[_0x43e319(0x122)]='-');}),sendButton[_0x59603a(0x15d,'F)up')](_0x408dde(0x109),sendMessage),userInput[_0x408dde(0x165)](_0x59603a(0x166,'ztI4'),_0x461547=>{const _0x21f40c=_0x59603a,_0x5e0e78=_0x408dde,_0x4783eb=_0x5af040,_0x155b87={'UdCoz':function(_0x42a31a,_0x3970c9){return _0x42a31a===_0x3970c9;},'UYkoB':_0x4783eb(0xef),'caYMy':function(_0xa765c6){return _0xa765c6();}};_0x155b87[_0x5e0e78(0x172)](_0x461547[_0x21f40c(0x131,'Atrk')],_0x155b87[_0x21f40c(0x117,'[[Kh')])&&_0x155b87['caYMy'](sendMessage);}),clearChatButton[_0x5af040(0xea)](_0x59603a(0x1a3,'RL*&'),()=>{const _0x542bcd=_0x408dde;chatWindow[_0x542bcd(0x181)]='',numGoejson=0x0;});